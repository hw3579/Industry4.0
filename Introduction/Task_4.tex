\section{Task 4: Simulink and Simulation}
\FloatBarrier % Now figures cannot float above section title

\subsection{Simulink}
Figure \ref{F 5.1} shows a schematic of Simulink.
\begin{figure}[htp]
    \centering
    \includegraphics[width=17cm]{./fig/sim.jpg}
    \caption{The Simulink}
    \label{F 5.1}
\end{figure}

\subsubsection*{Tidy of the model}
To ensure aesthetic appeal, a modular design approach was adopted, where different modules represent different functionalities, thereby making the overall model's operation flow appear clear and concise.

\subsubsection*{Trajectory generation}

\begin{figure}[htbp]
    \centering
    \includegraphics[width=10cm]{./fig/traj.png}
    \caption{The Denevit-Hartenberg frame}
    \label{F 5.2}
\end{figure}

Trajectory generation module is an important component of robot motion planning, as it allows robots to move safely and efficiently in complex environments.This module is to convert signals from one coordinate system to another so that we can have easier control of the system. Additionally, the trajectory needs to be smooth, so that the robot does not make sudden changes in direction or speed that may destabilize the system or cause discomfort to human users.

We first calculate the path coordinate points and time series from the code, and use them as input parameters for trajectory calculation. Through trajectory calculation, we can obtain the expected end-effector position and the motion trajectory data applicable to each point after coordinate transformation (which is a 4001*3 data, recording the three-dimensional coordinate points of the path every 0.01 seconds and simulated for a total of 40 seconds).

\begin{figure}[htbp]
	\centering
	\includegraphics[width=10cm]{./fig/siwei.png}
	\caption{plastic modules of rectangular section  }
	\label{F 5.3}
\end{figure}


\subsubsection*{Inverse kinematics}

Inverse Kinematics module is used to determine the joint angles of a robot, such that the robot's end-effector reaches a desired target position or orientation. Inverse kinematics is often an important component of robot control, such as robot path planning and robot motion control.

In the inverse kinematics module, we use the desired end-effector position as input and calculate the expected joint angles using inverse kinematics. The output is a matrix containing time-series data, which records the rotation angles of different joints of the robotic arm every 0.01 seconds.
\begin{figure}[htbp]
	\centering
	\includegraphics[width=8cm]{./fig/IK.png}
	\caption{plastic modules of rectangular section  }
	\label{F 5.4}
\end{figure}

\subsubsection*{Inverse dynamics}

Inverse dynamics is to calculate the forces or torques that are required to produce a desired motion of a robotic system. The technique involves using the system's equations of motion to determine the forces or torques required to generate a desired trajectory or motion. The input parameter in this part is the coordinate data of each sampling point calculated by the inverse kinematics. By weighting and differentiating the data, the required angular velocity and angular acceleration can be obtained. Then, the obtained data is imported into the inverse dynamics module for calculation, and the result is the torque required for each joint at each sampling point.

\begin{figure}[htbp]
	\centering
	\includegraphics[width=10cm]{./fig/ID.png}
	\caption{plastic modules of rectangular section  }
	\label{F 5.5}
\end{figure}

\subsubsection*{Gravity}


In this part, the torque generated by gravity is added as a vector to the torque required by each joint calculated by the inverse dynamics module, and the combined torque vector is passed to the next module to simulate the deviation that may occur in the actual robot arm.


\begin{figure}[htbp]
	\centering
	\includegraphics[width=6cm]{./fig/G.png}
	\caption{plastic modules of rectangular section  }
	\label{F 5.6}
\end{figure}


\subsubsection*{Forward dynamics and kinematics}


Forward kinematics module is to determine the position and orientation of a robot's end-effector based on the joint angles of the robot. 
Forward kinematics is also used in conjunction with inverse kinematics, which is used to determine the joint angles required to achieve a desired position and orientation of the end-effector. Together, forward and inverse kinematics form an important part of robot motion planning and control.

\begin{figure}[htbp]
	\centering
	\includegraphics[width=8cm]{./fig/FDK.png}
	\caption{plastic modules of rectangular section  }
	\label{F 5.7}
\end{figure}


\subsection{PID design}

With the aim of having better accruacy of the end effect position, we add a feedback control module. Feedback control is a control technique used in engineering to control a system by adjusting its behavior based on measured output signals. In feedback control, the output of the system is measured and compared to a desired end effect position. The difference between the measured output and the desired end effect position is called the error signal, which is then used to adjust the system's behavior through a feedback loop.

\begin{figure}[htbp]
	\centering
	\includegraphics[width=10cm]{./fig/PID.png}
	\caption{plastic modules of rectangular section}
	\label{F 5.8}
\end{figure}

In the PID control module, we subtract the desired data from the actual data to obtain the error value, which is then used for PID calculation. We noticed that joints 1, 3, and 4 only use PD controllers because these three joints require a fast response speed and low overshoot, and have lower requirements for steady-state error. For joint 2, which uses a PID controller, it is sensitive to steady-state error due to its rotation around the y-axis. Although there may be difficulty in tuning, we successfully completed the debugging process.


\subsection{Results}

Finally, set the end effector positions and the desired end effector positoins as the input, draw the plot with their x y z positions followed by the time respectively.

\begin{figure}[htbp]
	\centering
	\includegraphics[width=7cm]{./fig/re.png}
	\caption{plastic modules of rectangular section}
	\label{F 5.9}
\end{figure}


\subsubsection*{Input torque}


As shown in the figure below, this is the torque figure of each joint required for the robot during operation. By observing the figure, it can be found that, except for the initial instability during startup, we only need less than $30N\cdot m$ of torque to drive the robot to complete the welding task.

\begin{figure}[htbp]
	\centering
	\includegraphics[width=10cm]{./fig/3.jpg}
	\caption{plastic modules of rectangular section}
	\label{F 5.10}
\end{figure}

\subsubsection*{Joint angle}


As we can see in the 'joint angle error' plot.

\begin{figure}[htbp]
	\centering
	\includegraphics[width=8cm]{./fig/4.jpg}
	\includegraphics[width=8cm]{./fig/6.jpg}
	\caption{plastic modules of rectangular section}
	\label{F 5.11}
\end{figure}

The error of joint1 angle does not exceed the limit of $10^{-3}$, but it fluctuates throughout the process;
The error of joint2 angle is the largest, and it nearly reaches 0.02, the error tends to be stable except for large fluctuations at the peak throughout the process;
Both the maximum error of joint3 angle and joint4 angle are below 5*10-3, but joint3 angle error are steady increase to the maximum error, and remain stable on the maximum angle error; as for joint4 angle, there is almost no error in the first ten seconds, and there is always a period of stability after the changes of the error.
Overall, the errors are small and will not have a significant impact on the operation of the robot.

\subsubsection*{End Effector Position}


As we can see in the 'end effector position error' plot, the maximum error in end effector position on the x and z axes is below 0.05, while the maximum error on the y axis is slightly over 0.10. The errors in the x and z axes fluctuate simultaneously, while the error in the y axis gradually increases as the errors in the former axes begin to decrease. There is a small amount of error throughout the entire process, but it is not significant. It has almost no impact in reality.

\begin{figure}[htbp]
	\centering
	\includegraphics[width=8cm]{./fig/5.jpg}
	\includegraphics[width=8cm]{./fig/7.jpg}
	\caption{plastic modules of rectangular section}
	\label{F 5.12}
\end{figure}